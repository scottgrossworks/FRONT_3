<!-- 
    -- INDEX
    --
    -- theleedz.com STATS PAGE and login gateway
    --
    -->
   
    <!DOCTYPE html>
    <html lang="en">
    
    <head>
         <meta charset="UTF-8">
         <meta name="viewport" content="width=device-width, initial-scale=1.0">
     
         <title>Welcome to the Leedz</title>
     
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" href="./img/favicon.png"> 
    <link rel="icon" type="image/x-icon" href="./img/favicon.ico">

    <link rel="stylesheet" href="./css/globals.css" type="text/css" />
    <link rel="stylesheet" href="./css/stats.css" type="text/css" />
    <link rel="stylesheet" href="./css/trades.css" type="text/css" />
    <link rel="stylesheet" href="css/dropdown.css" type="text/css" />

    
    <script src="./js/trades.js" type="module" defer></script>
    <script src="./js/error.js" type="module" defer></script>
    <script src="./js/dbTools.js" type="module" defer></script>


    <meta name="description" content="A marketplace for vendors to buy and sell booking info - theleedz.com">
	
    <meta name="keywords" content="The Leedz, leedz, leads, lead generation, sales leads, parties, events, event production, talent, event planner, 
    event planning, wedding planning, wedding planner, weddings, quincineara, bookings, crm, catering, service providers, thumbtack, gigsalad, gigs, gig economy, vendors, marketing, 
    small business, sales, leads, parties">
	
	<meta name="author" content="Scott Gross">

        <!-- FIXME GOOGLE SITE VERIFICATION -->

 
   </head>  
    
   <body>


    <div class="row" id="stats_header">


                
        <div class="column dropdown _2">

            <span id="up_logo"><a href="javascript:dropdownMenu();">
                <img id="dropdown_logo" src="./img/logo_dd.png"></a></span>
            <div id="dropdown_menu" class="dropdown-content">

                
                <a class="login_url" style='color:green;' id="dd_login">Login</a>

                <a href="./leedz_how-to.html" id="dd_howto">How To</a>

                <a href="./leedz_about.html">About</a>

                <a href="./leedz_contact.html">Contact</a>

                <a href="./leedz_tos.html">Terms</a>

                <a href="./leedz_privacy.html">Privacy</a>

             </div>
        </div>

        

        <div class="column header_col _7">
            <center id="page_title"><a style="color:green;">Buy. Sell. Grow</a> your Hustle.</center>
        </div>
                

        <div class="column login_col _1">

        <!-- LOGIN BUTTON -->
        <a class="login_url">
            <button id="header_login" class="button stats_button" value="login">Login</button></a>

        </div>

    </div>



    
    <div class="row" id="links_header">

        <a href="./leedz_how-to.html">How-To</a>
        <a href="./leedz_about.html">About</a>
        <a href="./leedz_contact.html">Contact</a>
        <a href="./leedz_contact.html">Join Us</a>
    </div>


    <div class="container">
        


        
        <div class="item leedz_text">
            <span>
                <b>The Leedz</b> is a market for vendors to buy and sell booking opportunities.  
                When a client requests a time you have filled, sell that <b style='color:green'>leed</b> and 
                make money on the dates you <i>don't</i> work.  If you are just starting a new trade, 
                use <b>the Leedz</b> to find your first bookings.
                <BR>
                <BR>
                <b style="color:green;">Buy.  Sell.  Grow your hustle on the Leedz</b>.                 
            </span>
            <BR>
        </div>




        <div class="item" id="last_sale">
            <div class="item_title" style="width:100%">Last Sale</div>
     
            <span class="waitSpinner">
                <center>
                <img src="./img/wait_spinner.gif" style="height:8vh;">
                </center>
            </span>


            <table class="statsTable">
                        <TR><TD id="trade_div">
                            <!-- TRADE DIV -->
                            <b>Trade: </b>
                        <template id="template_each_trade">
                            <span class="each_trade" style="display:inline-block;padding-right:4px">
                                <button class="trade_radio" 
                                style="transform:translate(2px, 3px);"></button>
                                <label></label><sup></sup>
                                
                            </span>
                        </template>
                    
                    </TD></TR>

                        <TR><TD><a class="stats_date" id="date_bought_3"></a></TD></TR>
                        <TR><TD><b>Where:</b> <a id="sale_zip_2"></a></TD><TR>
                        <TR><TD><b>Sold for:</b> <a id="sale_price_2"></a></TD><TR>
                    </table>

        </div>







        
        
        

        <div class="item" id="login_item">
            <div class="item_title" style="width:100%">Secure Login</div>
            <span>Your <a href="./leedz_privacy.html">privacy</a> protected by <b>Amazon Web Services</b>.<b style='color:green'>The Leedz</b> uses Cloud-based encryption and security protocols to keep your data private.</span>
            <!-- LOGIN BUTTON -->
            <table><TR>
                <TD>
                    <img src="img/aws.png">
                </TD>
                <TD>
                    <a class="login_url">
                        <button id="loginButton" class="button stats_button" value="login">Login</button></a>
                </TD>
            </TR></table>

            
        </div>





        <div class="item leedz_text">
            <span>
                You choose which <b style='color:dodgerblue'>trades</b> to follow.  When a <b style='color:green'>leed</b> is posted to that trade, be the first to buy it and take it off the board.  
                You have all the contact info.  The customer who wants your service.
                <BR>
                <BR>All that's left to do is <b style='color:green'>make the sale</b>.
            </span>
            <BR>
        </div>




        



        
        <div class="item" id="top_trades">

            <div class="item_title" style="width:100%">Top Trades</div>


            <span class="waitSpinner">
                <center>
                <img src="./img/wait_spinner.gif" style="height:8vh;">
                </center>
            </span>


            <table class="statsTable">
                <TR>
                    <TD><b>Total trades: </b><a id="trades_total"></a></TD>
                </TR>
                <TR>
                    <TD><b><a id="maxTrades"></a> most popular: </b></TD>
                </TR>                
                <TR>
                    <td id="trades_table">

                        <template id="template_each_trade">
                            <span class="each_trade" style="display:inline-block;padding-right:4px">
                                <button class="trade_radio" 
                                style="transform:translate(2px, 3px);"></button>
                                <label></label><sup></sup>
                                
                            </span>
                        </template>
                    </td>
                </TR>
            </table>


        </div>



        

        

        <div class="item leedz_text">
            <span>
                <b>The Leedz</b> was created by a <a href='http://scottgross.works' target="_top">gig worker</a> who gets calls for the 
                same dates over and over.  Sell those <b style="color:green">leedz</b>.  Make back your advertising money, and develop a reliable network of colleagues 
                you can trade with in the future.
            </span>
        </div>

        

        

        

        <div class="item" id="square_item">
            <div class="item_title" style="width:100%">Square</div>
            <span>Pay and <b style="color:green">get paid</b> using <b>Square</b>, just like in your business.</span>
   
            <table><TR>
                <TD>The money you make selling <b style='color:green'>leedz</b> goes into your <b>Square</b> account.</TD>
                <TD><img id="sq_logo_invert" width="80" height="80" src="img/sq_logo.png"></TD>
            </TR></table>

            <BR>
            
        </div>










        <div class="item" id="leedz_live">
            <div class="item_title" style="width:100%">Leedz Live</div>
            
            <span class="waitSpinner">
                <center>
                <img src="./img/wait_spinner.gif" style="height:8vh;">
                </center>
            </span>


            <table class="statsTable">
            
                <TR>
                    <TD><b>Leedz</b> for sale: <a style='color:var(--LEEDZ_DARKGREEN)' id="leedz_posted"></a></TD>
                </TR>

                <TR><TD><b>Last post:</b></TD></TR>    
                <TR><TD><a id="date_posted"></a></TD></TR>

                <TR><TD><b>Last sale:</b></TD></TR>    
                <TR><TD><a id="date_bought_2"></a></TD></TR>

            </table>
            <BR>
        </div>
        





        <div class="item leedz_text">
            <span>
                <b stye="color:green">The Leedz</b> is in beta and welcomes new members by invitation to build a community of trusted vendors working together to grow their businesses.  
                If you are looking to invest in the gig economy and join our growing team, please <a href="mailto:theleedz.com@gmail.com">contact us</a>.
            </span>
        </div>






        <div class="item" id="contact_item">
            <div class="item_title" style="width:100%">Contact the Leedz</div>
           
            <span>
                <b><a href="mailto:theleedz.com@gmail.com">Contact</a> us to ask a question, add a new trade or request a feature.
            </span>
           
            <BR>
                <ul type="disc">
                
                    <li>How-To Hustle</li>
                    <li>Join our Team</li>
                    <li>Suggest a trade</li>
                    <li>Report a Bug</li>

                </ul>
            
            <!-- LOGIN BUTTON -->
            <button id="contactButton" class="button stats_button" value="contact" onclick="">Contact</button>
            <BR>
        </div>

    </div>

        <BR>
        <BR>
            
        <div class="row" id="stats_footer">
            <span>
            All content is &copy;2024 <a href="mailto:'mailto:theleedz.com@gmail.com" style="color:white">The Leedz</a>, all rights reserved, and may not be reproduced for 
            commercial purposes without written permission.
            </span>
        </div>

</body>







<script type="module" charset=”utf-8″>
	import { turnTrade_On, turnTrade_Off, getAllTrades, createTradesAndColors } from "./js/trades.js";
    import { db_getStats } from "./js/dbTools.js";
    import { printError, errorModal, throwError } from "./js/error.js";
    import { prettyFormatDT, formatDTforInput } from "./js/dates.js";

    const MAX_TRADES = 6;

    const URL_LOGIN = "https://theleedz.auth.us-west-2.amazoncognito.com/login?client_id=12tgt6nf496i446dq70gaoohrj&response_type=token&scope=email+openid+profile&redirect_uri=https%3A%2F%2Ftheleedz.com%2Fhustle.html";
    // set the LOGIN LINKS across the page
    const login_links = document.getElementsByClassName("login_url");
    for (let i = 0; i < login_links.length; i++) {
        login_links[i].href = URL_LOGIN;
      }

    const page_title = document.getElementById("page_title");
    page_title.style.maxWidth='100%';

       /**
         * DROP DOWN MENU
         */
         let DROP_DOWN = false;

         /* When the user clicks on the button,
         toggle between hiding and showing the dropdown content */
         export function dropdownMenu() {

          const menu = document.getElementById("dropdown_menu");
          menu.classList.toggle("show");

           DROP_DOWN ^= 1; // flip flag
         }
         window.dropdownMenu = dropdownMenu;
         





         


          //
          // ANY window click registers here
          //
          window.addEventListener( "click", (event) => {

       
            if (event.target.matches('a')) {
              
              // event.target will be http link
              window.open( event.target , "_self");
            
            } else if (! (event.target.matches('img'))) {
                var dropdown = document.getElementById("dropdown_menu");
                dropdown.classList.remove("show");

            }
           

          }, true);








/**
 * 
 * 
 */
 async function initStats() {

	waitCursor();
    try {
        const stats = await getStats();
            

        if (! stats) {
            throw new Error("server returned null stats.");
        }

        // console.log("STATS=");
        // console.log(stats);

        var element;
        
        
        const spinners = document.getElementsByClassName("waitSpinner");
        for (let j = 0; j< spinners.length; j++) {
            spinners[j].style.display = 'none';
        }
        const stats_tables = document.getElementsByClassName("statsTable");
        for (let j = 0; j< stats_tables.length; j++) {
            stats_tables[j].style.display = 'block';
          }

          
        element = document.getElementById("leedz_posted");
        element.innerHTML = stats.lp;

        
        // element = document.getElementById("leedz_bought");
        // element.innerHTML = stats.lb;

        // date posted
        let the_date = prettyFormatDT( formatDTforInput( stats.dp ) );
        element = document.getElementById("date_posted");
        element.innerHTML = the_date;

        // date bought
        the_date = prettyFormatDT( formatDTforInput( stats.db ) );

        element = document.getElementById("date_bought_2");
        element.innerHTML = the_date;
        element = document.getElementById("date_bought_3");
        element.innerHTML = the_date;


        // trade of last bought leed
        addToTradeDiv( stats.ab );


        element = document.getElementById("sale_price_2");
        element.innerHTML = '$ ' + stats.pr;

        element = document.getElementById("sale_zip_2");
        element.innerHTML = stats.zp;

    } catch (error) {
        
        // DO NOT FAIL -- show error modal dialog and print error to console
        var msg = "Cannot load stats.<BR>Please refresh page."
        msg = error.message + "<BR>" + msg;
        
        printError("Init Stats", error);
        // errorModal( msg , true );

    } finally {
        normalCursor();
    }


  }


    

/**
 * 
 * 
 */
 async function getStats() {
    try {
      const result = await db_getStats();
      return result;
    } catch (error) {
      // Handle any errors that occur during the fetch request
      throw error;
    }
}



/**
 * 
 * 
 */
 async function initTrades() {

	let trades = [];
  
	waitCursor();

	try {
	  await getAllTrades().then((response) => trades = response ); 
  
		if (trades == null) {
		  throw new Error("server returned null trades.");
		}
  
		if (trades.length == undefined || trades.length == 0) {
		  throw new Error("server returned empty (0) trades.");
		}



		// init TRADES struct
		// initialize the spectrum of colors
		createTradesAndColors( trades );  
		


		initTradesTable( trades );

        

  
	  } catch (error) {
		
		// DO NOT FAIL -- show error modal dialog and print error to console
		var msg = "Cannot load trades.<BR>Please refresh page."
		msg = error.message + "<BR>" + msg;
		
		printError("Init Trades Column", error);
		// errorModal( msg , true );
	
	} finally {
		normalCursor();
	}
  }


	





/**
 *
 * all_trades is the array 
 * 
 * ONLY display the trades to which the user is subscribed
 * [
 * {
   tn: "caricatures",
   nl: 5
 * }, .... 
 * ]
*/
function initTradesTable( all_trades ) {

	if ((all_trades == null) || (all_trades.length == 0)) return;
  

    var element = document.getElementById("maxTrades");		
    element.innerHTML = MAX_TRADES;

    element = document.getElementById("trades_total");
    element.innerHTML = all_trades.length;


	// import DOM elements from html
	const theList = document.querySelector("#trades_table");
	const subs = [];
	const theTemplate = document.querySelector("#template_each_trade");

    var count = 0;
	all_trades.forEach((trade) => {

        if (++count > MAX_TRADES) return;

        // clone a new node
        const newNode = theTemplate.content.cloneNode(true).querySelector(".each_trade");

        // set the label
        let theLabel = newNode.querySelector("label");
        theLabel.textContent = trade.sk;
        
        // set the leed count as a superscript
        newNode.querySelector("sup").textContent = trade.nl;

        let radioButton = newNode.querySelector(".trade_radio");
        turnTrade_On(null, radioButton, theLabel, trade.sk);

        theList.appendChild( newNode );
	});

    
}


	

/**
 * The trade of the last sale
 *
 */
function addToTradeDiv( trade_name ) {
    const theList = document.querySelector("#trade_div");
    const theTemplate = document.querySelector("#template_each_trade");

    // clone a new node
    const newNode = theTemplate.content.cloneNode(true).querySelector(".each_trade");

    // set the label
    let theLabel = newNode.querySelector("label");
    theLabel.textContent = trade_name;

    let radioButton = newNode.querySelector(".trade_radio");
    turnTrade_On(null, radioButton, theLabel, trade_name);


    theList.appendChild( newNode );
}



/**
 * Change to a wait cursor
 */
 function waitCursor() {
    document.body.style.cursor = 'wait';
}

/**
 * Change back to normal cursor
 */
function normalCursor() {
    document.body.style.cursor = 'default';
}




/**
 * WINDOW OPEN 
 * PAGE LOAD
 *
 *
 */
window.onload = async function() {
    await initTrades();
    await initStats();

}



</script>

</body>
</html>