
   
<!DOCTYPE html>
<html lang="en">
	
	<head>
		 <meta charset="UTF-8">
		 <meta name="viewport" content="width=device-width, initial-scale=1.0">
	 
		 <TITLE>Edit Leed</TITLE>
	 
	 	<!-- Favicon -->
		 <link rel="shortcut icon" type="image/png" href="./img/favicon.png"> 
		 <link rel="icon" type="image/x-icon" href="./img/favicon.ico">
 
 
		 <link rel="stylesheet" href="./css/globals.css" type="text/css" />
		 <link rel="stylesheet" href="./css/leed_edit.css" tyep="text/css"/>

		 <script src="./js/inline-edit.js" type="module" defer></script> 
	</head>


		 
	<center>


	<body>
	


			
			<div class="row titleRow">

			    <div class="column _1">

                    <button class="back_button" style="margin:35px 20px; width:50px"><a href="#" onclick="backButton()">&#10140;</a></button>
                    </div>

                    <div class="column _2"></div>
                    <div class="column _4" style="margin:auto 0;transform:translateY(6px)">
                        <h1 class="user_title">Edit Leed</h1>
                    </div>
                    
                    <div class="column _3" style="padding:6px;text-align:center">
                    <img src="./img/logo_2.png" style="width:120px">
                    </div>
                
			
		
			    </div>
            <div>

			

	<BR>	


<div class="row" id="form_container">
    <ul style="list-style:none;">


        <li>
        <table>


            <tr id="row_trade">
                            
                <TD class="labelTD">Trade Name: </TD>
                
                <td id="td_trade" data-inlineType="trade_name" data-inlineName="trade" data-inlineRequired="1" data-inlinePlaceholder="(Required)"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_trade', defaultOptions)"/>
                </td>

                <TD class="eyeballTD"><img src="./img/eye_show.png"  id="2_eye" class="lock"></TD>
            </tr>




            <tr id="row_note">
                        
                <TD class="labelTD">Title: </TD>
                
                <td id="td_note" data-inlineType="text" data-inlineName="note" data-inlineRequired="1" data-inlinePlaceholder="(Required)"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_note', defaultOptions)"/>
                </td>

               <TD class="eyeballTD"><img src="./img/eye_show.png" id="9_eye" class="lock"></TD>
            </tr>



            <!-- FIXMEFIXMEFIXME date/time chooser -->
            <tr id="row_start">
                        
                <TD class="labelTD">Start Time: </TD>
                
                <td id="td_start" data-inlineType="date" data-inlineName="start" data-inlineRequired="1" data-inlinePlaceholder="(Required)"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_start', defaultOptions)"/>
                </td>

               <TD class="eyeballTD"><img src="./img/eye_show.png" id="5_eye" class="lock"></TD>
            </tr>


                    
            <!-- FIXMEFIXMEFIXME date/time chooser -->
            <tr id="row_end">
                        
                <TD class="labelTD">End Time: </TD>
                
                <td id="td_end" data-inlineType="date" data-inlineName="end" data-inlineRequired="1" data-inlinePlaceholder="(Required)"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_end', defaultOptions)"/>
                </td>

               <TD class="eyeballTD"><img src="./img/eye_show.png"  id="6_eye" class="lock"></TD>
            </tr>



            <!-- ADDRESS 
            
            FIXME FIXME FIXME
            need special validation for address
            read zip from last 5 digits of address.trim()
            -->
            <tr id="row_loc">
                        
                <TD class="labelTD">Address: </TD>
                
                <td id="td_loc" data-inlineType="text" data-inlineName="loc" data-inlineRequired="1" data-inlinePlaceholder="(Required)"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_loc', defaultOptions)"/>
                </td>

                
               <TD class="eyeballTD"><img src="./img/eye_show.png" id="3_eye" eyeball="show" onclick="toggleEyeball( 3 )"></TD>
            </tr>




            


            <!-- LEED EMAIL 
            -->
            <tr id="row_em">
                            
                <TD class="labelTD">Client Email: </TD>
                
                <td id="td_em" data-inlineType="email" data-inlineName="em" data-inlineRequired="0"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_em', defaultOptions)"/>
                </td>

                <TD class="eyeballTD"><img src="./img/eye_show.png" id="7_eye" eyeball="show" onclick="toggleEyeball( 7 )"></TD>
            </tr>




            <!-- LEED PHONE 
            -->
            <tr id="row_ph">
                            
                <TD class="labelTD">Client Phone: </TD>
                
                <td id="td_ph" data-inlineType="tel" data-inlineName="ph" data-inlineRequired="0"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_ph', defaultOptions)"/>
                </td>

                
                <TD class="eyeballTD"><img src="./img/eye_show.png" id="8_eye" eyeball="show" onclick="toggleEyeball( 8 )"></TD>
            </tr>





            <!-- LEED DETAILS -->
            <tr id="row_det">
                        
                <TD class="labelTD">Details: </TD>
                
                <td id="td_det" data-inlineType="text" data-inlineName="det" data-inlineRequired="1" data-inlinePlaceholder="(Required)"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_det', defaultOptions)"/>
                </td>

                <TD class="eyeballTD"><img src="./img/eye_show.png" id="10_eye" eyeball="show" onclick="toggleEyeball( 10 )"></TD>
            </tr>



            
            <!-- LEED REQUIREMENTS -->
            <tr id="row_reqs">
                        
                <TD class="labelTD">Requirements: </TD>
                
                <td id="td_reqs" data-inlineType="text" data-inlineName="reqs" data-inlineRequired="0"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_reqs', defaultOptions)"/>
                </td>

                <TD class="eyeballTD"><img src="./img/eye_show.png" id="11_eye" eyeball="show" onclick="toggleEyeball( 11 )"></TD>
            </tr>


            
            <!-- LEED PRICE -->
            <tr id="row_det">
                        
                <TD class="labelTD">Price: </TD>
                
                <td id="td_pr" data-inlineType="text" data-inlineName="pr" data-inlineRequired="1" data-inlinePlaceholder="(Required)"></td>

                <td data-inlineType="doneButton" class="buttonTD">
                    <input type="button" value="Edit" onclick="inlineEdit('row_price', defaultOptions)"/>
                </td>

               <TD class="eyeballTD"><img src="./img/eye_show.png" id="12_eye" class="lock"></TD>
            </tr>



                    


        </table>	
        </li>

    </ul>
</div>


<div class="row">
        <!-- SAVE CHANGES BUTTON -->
        <button id="saveButton" class="button save_button" value="save" style="opacity:0.5" onclick="saveChanges()">Save Changes</button>
</div>
        


<div class="row">
        <!-- DELETE BUTTON -->
        <button id="delButton" class="button del_button" value="del" style="opacity:1.0" onclick="deleteLeed()">Delete Leed</button>
</div>



    <BR>
    <BR>


</body>


	<script type="module">
			
        import { getWeekday, getHours, getMinutes, getShortMonthname, getMonthname } from "./js/dates.js";
        import { getShortDateString, DTfromPretty } from "./js/dates.js";
		
        import { inlineEmailFinishCell, inlineURLFinishCell } from "./js/inline-edit.js";
		import { inlineEdit } from "./js/inline-edit.js";
        import { getCurrentUser } from "./js/user.js";
        import { clearCurrentLeed, getCurrentLeed, blankLeedObject, saveLeedChanges } from "./js/leed.js";
		import { printError, throwError, errorModal } from "./js/error.js";
		
        import { CACHE_LEED_KEY } from "./js/leed.js";
        import { USERNAME_URL_PARAM } from "./js/dbTools.js";

        import { LEED_KEYS }  from "./js/leed.js";




        
        //
        //
        let leedJSON = window.sessionStorage.getItem( CACHE_LEED_KEY );
        if (leedJSON == undefined || leedJSON == null) {
            printError("Edit Leed", "Cannot retrieve cache leed with key:" + CACHE_LEED_KEY );
            errorModal("Cannot load Leed info from cache", true);
            throwError("Error loading cache leed");
        }
    
        let cache_leed = null;
        // load leed obj from cache
        try {
        cache_leed = JSON.parse( leedJSON );
    
        } catch (error) {
            printError("Cannot parse leed JSON", leedJSON);
            errorModal("Cache leed has invalid JSON format", true);
            throwError("Error parsing cahce leed JSON");
        }

    
          //
          //
		var EDITING = false;

		const CURRENT_LEED = getCurrentLeed();
        const LEED_CHANGES = blankLeedObject();

        console.log("GOT CURRENT LEED");
        console.log(CURRENT_LEED);

        if (CURRENT_LEED == null)
            throwError("Cannot initialize leed editor: CURRENT_LEED is null");



        var element = null;
        
        element = document.getElementById("td_trade");
        element.innerHTML = CURRENT_LEED.trade;

        element = document.getElementById("td_note");
        element.innerHTML = CURRENT_LEED.note;


        // THE DATE
        // start and end times
        const startDate = new Date( CURRENT_LEED.start );
        const isoStart = startDate.toISOString();

        const start_weekday = getWeekday( getShortDateString( isoStart ) );
        const start_monthname = getShortMonthname( isoStart.substring(5, 7) ); 

        // remove '0' at front if any
        let start_date = isoStart.substring(8, 10);
        if (start_date.startsWith('0')) { start_date = start_date.substring(1) };

        const endDate = new Date( CURRENT_LEED.end );
        const isoEnd = endDate.toISOString();
       
        const end_weekday = getWeekday( getShortDateString( isoEnd ) );
        const end_monthname = getShortMonthname( isoEnd.substring(5, 7) ); 
        
        // remove '0' at front if any
        let end_date = isoStart.substring(8, 10);
        if (end_date.startsWith('0')) { end_date = end_date.substring(1) };
        
        const leed_year = isoStart.substring(0, 4);
        const hours_start = getHours(isoStart);
        const hours_end = getHours(isoEnd);
    

        const fullStartDate = start_weekday + " " + start_monthname + " " + start_date + ", " + leed_year; 

        const fullEndDate = end_weekday + " " + end_monthname + " " + end_date + ", " + leed_year; 


        const start_time = hours_start[0] + ":" + getMinutes(isoStart) + hours_start[1];
        const end_time = hours_end[0] + ":" + getMinutes(isoEnd) + hours_end[1];



        element = document.getElementById("td_start");
        element.innerHTML = fullStartDate + " at " + start_time;


        element = document.getElementById("td_end");
        element.innerHTML = fullEndDate + " at " + end_time;




        element = document.getElementById("td_loc");
        element.innerHTML = CURRENT_LEED.loc;
        if (CURRENT_LEED.opts[ LEED_KEYS.LOC ] == "hide")
            toggleEyeball( LEED_KEYS.LOC );
            


        element = document.getElementById("td_em");
        element.innerHTML = CURRENT_LEED.em;
        if (CURRENT_LEED.opts[ LEED_KEYS.EM ] == "hide")
            toggleEyeball( LEED_KEYS.EM );



        element = document.getElementById("td_ph");
        element.innerHTML = CURRENT_LEED.ph
        if (CURRENT_LEED.opts[ LEED_KEYS.PH ] == "hide")
            toggleEyeball( LEED_KEYS.PH );



        element = document.getElementById("td_det");
        element.innerHTML = CURRENT_LEED.det;
        if (CURRENT_LEED.opts[ LEED_KEYS.DET ] == "hide")
        toggleEyeball( LEED_KEYS.DET );



        element = document.getElementById("td_reqs");
        element.innerHTML = CURRENT_LEED.reqs;
        if (CURRENT_LEED.opts[ LEED_KEYS.REQS ] == "hide")
            toggleEyeball( LEED_KEYS.REQS );



        element = document.getElementById("td_pr");
        element.innerHTML = "<B>$&nbsp;" + CURRENT_LEED.pr + "</B>";









		function backButton() {
			const CURRENT_USER = getCurrentUser(true);
	
			let href="./index.html?" + USERNAME_URL_PARAM + "=" + CURRENT_USER.username;
			window.open(href);

			clearCurrentLeed();
			self.close();

		}
		window.backButton = backButton;








		function defaultCallback(rowData, rowName) {

			beginEditing();


            console.log("%cIN CB", "color:orange;");


			switch(rowName) {

                case "row_trade":
                    LEED_CHANGES.trade = rowData["trade"];
                    break;

				case "row_note":
					LEED_CHANGES.note = rowData["note"];
					break;

				case "row_start":
                    var dateTime = DTfromPretty( rowData["start"] );
					LEED_CHANGES.start = dateTime;
					break;

                case "row_end":
                    var dateTime = DTfromPretty( rowData["end"] );
                    LEED_CHANGES.end = dateTime;
                    break;


                case "row_em":
                    LEED_CHANGES.em = rowData["em"];
                    break;

                case "row_ph":
                    LEED_CHANGES.ph = rowData["ph"];
                    break;


                case "row_zip":
                    LEED_CHANGES.loc = rowData["zip"];
                    break;


				case "row_loc":
					LEED_CHANGES.loc = rowData["loc"];
					break;

				case "row_det":
					LEED_CHANGES.det = rowData["det"];
					break; 
					
				case "row_reqs":
					LEED_CHANGES.reqs = rowData["reqs"];
					break; 


				case "row_price":
					LEED_CHANGES.price = rowData["price"];
					break; 

				default:
					printError("defaultCallback()", "received unknown form field: " + rowName);
					break;

			}

			
            console.log("SHOWING LEED CHANGES");
            console.log(LEED_CHANGES);

		}






		//
		//
		//
		function beginEditing() {
			var element = document.getElementById("saveButton");
			element.innerHTML = "Save Changes";
			element.style.backgroundColor = "var(--LEEDZ_GREEN)";
			element.style.opacity = 1;

			EDITING = true;
		}


		//
		//
		//
		function endEditing() {
			var element = document.getElementById("saveButton");
			element.innerHTML = "Saved!";
			element.style.backgroundColor = "darkorange";
			element.style.opacity = 0.5;

			EDITING = false;
		}



		//
		//
		//
		function saveChanges() {

			if (! EDITING) return;

			saveLeedChanges( LEED_CHANGES );

			endEditing();
		}
		window.saveChanges = saveChanges;



        //
        //
        //
        function toggleEyeball( fieldName ) {
            
            beginEditing();


            let theImg = document.getElementById(fieldName + "_eye");
      

            if (theImg.eyeball == "hide") {

                theImg.src = "./img/eye_show.png";
                theImg.eyeball = "show";
                theImg.style.opacity = 1;
                LEED_CHANGES.opts[fieldName] = '1';

            } else {
                
                theImg.src = "./img/eye_hide.png";
                theImg.eyeball = "hide";
                theImg.style.opacity = 0.35;
                LEED_CHANGES.opts[fieldName] = '0';
            }

        }
        window.toggleEyeball = toggleEyeball;

        


		function deleteLeed() {
            console.log("DELETE LEED");

            // FIXME FIXME FIXME some kind of feedback that leed successfully deleted
		}
		window.deleteLeed = deleteLeed;



		var defaultOptions = { "finishCallback": defaultCallback };

		window.inlineEdit = inlineEdit;
		window.defaultOptions = defaultOptions;


	
	
	</script>

	
		


</html>